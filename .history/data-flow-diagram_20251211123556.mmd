%% SafeTraveler - Flux de DonnÃ©es Principaux
%% Ouvrez ce fichier sur https://mermaid.live pour gÃ©nÃ©rer l'image

graph TD
    %% Flux de Navigation et Calcul d'ItinÃ©raire
    Start[ğŸ‘¤ Utilisateur sur Page Navigation]
    SelectLoc[ğŸ¯ SÃ©lectionne DÃ©part + Destination]
    CalcRoute[âš™ï¸ handleCalculateRoute]
    GetCoords[ğŸ“ RÃ©cupÃ¨re coordonnÃ©es<br/>airport-data.json]
    FindWaypoints[ğŸ” findIntermediateWaypoints<br/>Points intermÃ©diaires]
    CallMapbox[ğŸŒ getMapboxDirections<br/>Appel API Mapbox]
    ReceiveGeo[ğŸ“¦ ReÃ§oit gÃ©omÃ©trie trajet]
    ExtractPath[ğŸ—ºï¸ extractRoutePath<br/>Convertit coordonnÃ©es]
    ExtractInst[ğŸ“‹ extractRouteInstructions<br/>GÃ©nÃ¨re instructions]
    UpdateState[ğŸ’¾ Mise Ã  jour State]
    DisplayRoute[âœ… Affichage]
    ShowLine[â”â” Ligne sur carte]
    ShowPanel[ğŸ“± Panel instructions]
    ShowSummary[â±ï¸ Distance/DurÃ©e]
    
    Start --> SelectLoc
    SelectLoc --> CalcRoute
    CalcRoute --> GetCoords
    GetCoords --> FindWaypoints
    FindWaypoints --> CallMapbox
    CallMapbox --> ReceiveGeo
    ReceiveGeo --> ExtractPath
    ReceiveGeo --> ExtractInst
    ExtractPath --> UpdateState
    ExtractInst --> UpdateState
    UpdateState --> DisplayRoute
    DisplayRoute --> ShowLine
    DisplayRoute --> ShowPanel
    DisplayRoute --> ShowSummary
    
    %% Flux de SÃ©lection de Classe
    UserArrives[ğŸ‘¤ Utilisateur arrive]
    ShowModal[ğŸ« ClassSelectorModal s'affiche]
    ChooseClass[ğŸ¯ Choisit classe<br/>Economy/Business/First]
    SetProfile[ğŸ’¾ PassengerContext.setProfile]
    SaveLocal[ğŸ’¿ Sauvegarde localStorage]
    UpdateGlobal[ğŸ”„ Met Ã  jour state global]
    Rerender[ğŸ”ƒ Re-render composants]
    UpdateRoadmap[ğŸ—ºï¸ Roadmap Ã©tapes adaptÃ©es]
    UpdateFAB[ğŸ”˜ ClassFAB couleur classe]
    UpdateNav[ğŸ§­ Navigation filtre lieux]
    
    UserArrives --> ShowModal
    ShowModal --> ChooseClass
    ChooseClass --> SetProfile
    SetProfile --> SaveLocal
    SetProfile --> UpdateGlobal
    UpdateGlobal --> Rerender
    Rerender --> UpdateRoadmap
    Rerender --> UpdateFAB
    Rerender --> UpdateNav
    
    %% Flux de Recherche
    SearchStart[ğŸ” Utilisateur tape recherche]
    SetQuery[ğŸ’¾ setSearchQuery]
    FilterLocs[âš™ï¸ filteredLocations.filter]
    FilterName[ğŸ“ Filtre par nom]
    FilterDesc[ğŸ“„ Filtre par description]
    FilterType[ğŸ·ï¸ Filtre par type]
    UpdateMap[ğŸ—ºï¸ EnhancedAirportMap<br/>reÃ§oit filteredLocations]
    ShowMarkers[ğŸ“ Affiche marqueurs filtrÃ©s]
    
    SearchStart --> SetQuery
    SetQuery --> FilterLocs
    FilterLocs --> FilterName
    FilterLocs --> FilterDesc
    FilterLocs --> FilterType
    FilterName --> UpdateMap
    FilterDesc --> UpdateMap
    FilterType --> UpdateMap
    UpdateMap --> ShowMarkers
    
    %% Flux i18n
    ChangeLang[ğŸŒ Utilisateur change langue]
    LangOnChange[âš™ï¸ LanguageSelector.onChange]
    SetLocale[ğŸ’¾ LocaleContext.setLocale]
    UpdateCookie[ğŸª Met Ã  jour cookie]
    LoadMessages[ğŸ“¦ Recharge messages<br/>fr.json ou en.json]
    RerenderAll[ğŸ”ƒ Composants avec t re-rendent]
    UpdateTexts[âœ… Textes mis Ã  jour]
    
    ChangeLang --> LangOnChange
    LangOnChange --> SetLocale
    SetLocale --> UpdateCookie
    SetLocale --> LoadMessages
    LoadMessages --> RerenderAll
    RerenderAll --> UpdateTexts
    
    %% Styles
    classDef userAction fill:#4F46E5,stroke:#312E81,stroke-width:2px,color:#fff
    classDef process fill:#10B981,stroke:#065F46,stroke-width:2px,color:#fff
    classDef data fill:#F59E0B,stroke:#B45309,stroke-width:2px,color:#fff
    classDef display fill:#3B82F6,stroke:#1E40AF,stroke-width:2px,color:#fff
    classDef api fill:#EF4444,stroke:#991B1B,stroke-width:2px,color:#fff
    
    class Start,SelectLoc,UserArrives,ChooseClass,SearchStart,ChangeLang userAction
    class CalcRoute,FindWaypoints,SetProfile,FilterLocs,LangOnChange process
    class GetCoords,SaveLocal,UpdateGlobal,SetQuery,SetLocale,UpdateCookie data
    class DisplayRoute,ShowLine,ShowPanel,ShowSummary,UpdateRoadmap,UpdateFAB,UpdateNav,ShowMarkers,UpdateTexts display
    class CallMapbox,ReceiveGeo,LoadMessages api

